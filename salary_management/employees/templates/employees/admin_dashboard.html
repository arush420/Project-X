{% extends 'base.html' %}
{% block title %}Admin Dashboard{% endblock %}
{% block content %}
<h1>Admin Dashboard</h1>
<p>Total Employees: {{ total_employees }}</p>
<p>Total Salary Payout: {{ total_salary| floatformat:2 }}</p>

<div class="dashboard-container" style="display: flex; flex-direction: column;">
    <!-- Bar Graph -->
    <div class="chart-container" style="width: 100%; margin-bottom: 20px;">
        <canvas id="adminChart"></canvas>
        <!-- Buttons to select dataset -->
        <div>
            <button onclick="updateChart('salary')">Salary</button>
            <button onclick="updateChart('employees')">Employees</button>
            <button onclick="updateChart('purchases')">Purchases</button>
        </div>
    </div>

    <!-- Table -->
    <div class="table-container" style="width: 100%; margin-top: 20px;">
        <h2>Recent Salaries</h2>
        <table border="1">
            <thead>
                <tr>
                    <th>Employee</th>
                    <th>Month</th>
                    <th>Net Salary</th>
                </tr>
            </thead>
            <tbody>
                {% for salary in recent_salaries %}
                <tr>
                    <td>{{ salary.employee.name }}</td>
                    <td>{{ salary.month }}</td>
                    <td>{{ salary.net_salary }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="btn-group mb-4" role="group">
            <a href="{% url 'employees:staff_salary_list' %}" class="btn btn-primary">Staff Employees List</a>
            <a href="{% url 'employees:staff_salary_create' %}" class="btn btn-primary">Staff Employees Create</a>

</div>

<script>
    var ctx = document.getElementById('adminChart').getContext('2d');

    // Initial data for Salary chart
    var chartData = {
        labels: {{ months | safe }},
        datasets: [{
            label: 'Salary Payout',
            data: {{ salary_data | safe }},
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 1
        }]
    };

    var adminChart = new Chart(ctx, {
        type: 'bar',
        data: chartData,
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // Data for employees and purchases
    var employeesData = {{ employees_data | safe }};
    var purchasesData = {{ purchases_data | safe }};

    // Function to update the chart based on the selected button
    function updateChart(type) {
        if (type === 'salary') {
            adminChart.data.datasets[0].data = {{ salary_data | safe }};
            adminChart.data.datasets[0].label = 'Salary Payout';
        } else if (type === 'employees') {
            adminChart.data.datasets[0].data = employeesData;
            adminChart.data.datasets[0].label = 'Total Employees';
        } else if (type === 'purchases') {
            adminChart.data.datasets[0].data = purchasesData;
            adminChart.data.datasets[0].label = 'Purchases';
        }
        adminChart.update();
    }
</script>
{% endblock %}
