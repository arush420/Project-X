{% extends 'base.html' %}

{% block title %}Purchase Bill Entry{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">Purchase Bill Entry</h1>

    <!-- Purchase Entry Form -->
    <form method="post">
        {% csrf_token %}
        <div class="form-row">
            <div class="col-md-6 mb-3">
                {{ form.organization_code.label }} {{ form.organization_code }}
            </div>
            <div class="col-md-6 mb-3">
                {{ form.bill_number.label }} {{ form.bill_number }}
            </div>
        </div>

        <div class="form-row">
            <div class="col-md-6 mb-3">
                {{ form.organization_name.label }} {{ form.organization_name }}
            </div>
            <div class="col-md-6 mb-3">
                {{ form.date_of_purchase.label }} {{ form.date_of_purchase }}
            </div>
        </div>

        <div class="form-row">
            <div class="col-md-6 mb-3">
                {{ form.purchased_item.label }} {{ form.purchased_item }}
            </div>
            <div class="col-md-6 mb-3">
                {{ form.category.label }} {{ form.category }}
            </div>
        </div>

        <div class="form-row">
            <div class="col-md-4 mb-3">
                {{ form.per_unit_cost.label }} {{ form.per_unit_cost }}
            </div>
            <div class="col-md-4 mb-3">
                {{ form.units_bought.label }} {{ form.units_bought }}
            </div>
            <div class="col-md-4 mb-3">
                {{ form.hsn_code.label }} {{ form.hsn_code }}
            </div>
        </div>

        <h3 class="mt-4">Taxes</h3>
        <div class="form-row">
            <div class="col-md-4 mb-3">
                {{ form.cgst_rate.label }} {{ form.cgst_rate }}
            </div>
            <div class="col-md-4 mb-3">
                {{ form.sgst_rate.label }} {{ form.sgst_rate }}
            </div>
            <div class="col-md-4 mb-3">
                {{ form.igst_rate.label }} {{ form.igst_rate }}
            </div>
        </div>

        <button type="submit" class="btn btn-primary">Submit</button>
    </form>

    <!-- Submitted Entries Table -->
    <h2 class="mt-5">Submitted Purchase Entries</h2>

    <table class="table table-striped mt-3">
        <thead>
            <tr>
                <th>Item Name</th>
                <th>Quantity</th>
                <th>Price/Unit</th>
                <th>Total Price</th>
                <th>CGST</th>
                <th>SGST</th>
                <th>IGST</th>
                <th>Total GST</th>
                <th>Net Price</th>
            </tr>
        </thead>
        <tbody>
            {% for item in purchases %}
            <tr>
                <td>{{ item.purchased_item }}</td>
                <td>{{ item.units_bought }}</td>
                <td>{{ item.per_unit_cost }}</td>
                <td>{{ item.gross_total }}</td>
                <td>{{ item.cgst_rate }}%</td>
                <td>{{ item.sgst_rate }}%</td>
                <td>{{ item.igst_rate }}%</td>
                <td>{{ item.total_gst }}</td>
                <td>{{ item.net_price }}</td>
            </tr>
            {% endfor %}
            <!-- Totals Row -->
            <tr>
                <th>Total</th>
                <td>{{ total_quantity }}</td>
                <td></td>
                <td>{{ total_price_sum }}</td>
                <td>{{ cgst_sum }}</td>
                <td>{{ sgst_sum }}</td>
                <td>{{ igst_sum }}</td>
                <td>{{ total_gst_sum }}</td>
                <td>{{ total_value_sum }}</td>
            </tr>
        </tbody>
    </table>
</div>
{% endblock %}
